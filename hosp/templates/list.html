<html><head>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Manrope%3Awght%40400%3B500%3B700%3B800&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
<meta charset="utf-8"/>
<title>Stitch Design</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<style type="text/tailwindcss">
      :root {
        --primary-color: #4798ea;
        --secondary-color: #f7f9fc;
        --background-color: #ffffff;
        --text-primary: #111827;
        --text-secondary: #6b7280;
        --accent-color: #e5e7eb;
      }
      body {
        font-family: 'Manrope', sans-serif;
        background-color: var(--background-color);
        color: var(--text-primary);
      }
    </style>
</head>
<body class="bg-[var(--background-color)]">
<div class="relative flex size-full min-h-screen flex-col group/design-root overflow-x-hidden">
<div class="layout-container flex h-full grow flex-col">
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-[var(--accent-color)] px-4 sm:px-10 py-4">
<div class="flex items-center gap-3 text-[var(--text-primary)]">
<div class="size-6 text-[var(--primary-color)]">
<svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path clip-rule="evenodd" d="M12.0799 24L4 19.2479L9.95537 8.75216L18.04 13.4961L18.0446 4H29.9554L29.96 13.4961L38.0446 8.75216L44 19.2479L35.92 24L44 28.7521L38.0446 39.2479L29.96 34.5039L29.9554 44H18.0446L18.04 34.5039L9.95537 39.2479L4 28.7521L12.0799 24Z" fill="currentColor" fill-rule="evenodd"></path>
</svg>
</div>
<h1 class="text-[var(--text-primary)] text-xl font-bold tracking-tight">AIxploria</h1>
</div>
<div class="hidden sm:flex flex-1 justify-end items-center gap-4">
<button id="send-reminders-btn" class="flex items-center gap-2 bg-[var(--primary-color)] text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition-colors">
<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg">
<path d="M224,48H32a8,8,0,0,0-8,8V192a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A8,8,0,0,0,224,48ZM203.43,64,128,133.15,52.57,64ZM216,192H40V74.19l82.59,75.71a8,8,0,0,0,10.82,0L216,74.19V192Z"></path>
</svg>
<span>Send Reminders</span>
</button>
<div class="flex items-center gap-2 text-[var(--primary-color)] font-bold">
<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg">
<path d="M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM40,56H216v32H40ZM216,200H40V104H216Z"></path>
<circle cx="60" cy="72" r="8"></circle>
<circle cx="84" cy="72" r="8"></circle>
</svg>
<span>Appointments: <span id="total-appointments">0</span></span>
<span id="date-filter-indicator" class="ml-2 text-sm hidden px-2 py-1 bg-[var(--secondary-color)] rounded-full"></span>
</div>
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBdsxh6GZJVDCehC8zTtoVl8TCS3nZcvtJ6VzNpoX3a433bbtTGqIWBZa9QJttWeSKTRC0XlTyjvijCxKoMZYe0wmJXLaH0Xi-4PvX8O2c4JJPlapqUuMfYu22MoZwhc9LhOjLuMBLiWoocgqSEXgf6Fker6woXLTORhHAL_wMZTxUs_Fr3NWarn_rDda_Zdyj3m2eRa93Nr7MnjjdxyJlwiAdDSNpEwzCiF2poDXwY5jamDu6sv22NTBpb6WoMZ2wBVjZRmaR3trQ");'></div>
</div>
</header>
<main class="flex-1 px-4 sm:px-6 lg:px-10 py-8">
<div class="max-w-7xl mx-auto">
<div class="flex flex-col sm:flex-row gap-4 mb-6">
<div class="relative flex-grow">
<div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-[var(--text-secondary)]">
<svg class="w-5 h-5" fill="currentColor" height="24px" viewBox="0 0 256 256" width="24px" xmlns="http://www.w3.org/2000/svg">
<path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path>
</svg>
</div>
<input id="date-search" class="form-input w-full pl-10 pr-4 py-3 rounded-lg border-2 border-[var(--accent-color)] bg-[var(--background-color)] text-[var(--text-primary)] placeholder:text-[var(--text-secondary)] focus:ring-2 focus:ring-[var(--primary-color)] focus:border-transparent transition-all" placeholder="Enter date (DD-MM-YYYY)" type="search"/>
<div id="search-instructions" class="absolute -bottom-6 left-0 text-xs text-[var(--text-secondary)]">Format: DD-MM-YYYY (e.g., 02-08-2025)</div>
</div>
<div class="flex items-center gap-3">
<div class="flex gap-2">
<button id="search-by-date" class="flex items-center justify-center gap-x-2 rounded-lg bg-[var(--primary-color)] px-4 py-3 text-sm font-medium text-white hover:bg-opacity-90 transition-colors">
<span>Search</span>
<svg fill="currentColor" height="20px" viewBox="0 0 256 256" width="20px" xmlns="http://www.w3.org/2000/svg">
<path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path>
</svg>
</button>
<button id="clear-search" class="flex items-center justify-center gap-x-2 rounded-lg bg-[var(--secondary-color)] px-4 py-3 text-sm font-medium text-[var(--text-primary)] hover:bg-[var(--accent-color)] transition-colors">
<span>Clear</span>
<svg fill="currentColor" height="20px" viewBox="0 0 256 256" width="20px" xmlns="http://www.w3.org/2000/svg">
<path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path>
</svg>
</button>
</div>
</div>
</div>
<div id="data-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
</div>
<div class="bg-[var(--background-color)] rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 overflow-hidden flex flex-col">
<div class="p-5 flex-grow">
<!-- Notification container -->
<div id="notification" class="fixed top-4 right-4 z-50 max-w-sm bg-white border border-gray-200 rounded-lg shadow-lg transform transition-transform duration-300 translate-y-[-100%] opacity-0">
  <div class="p-4 flex items-start">
    <div id="notification-icon" class="flex-shrink-0 w-6 h-6 mr-3"></div>
    <div class="flex-1">
      <h3 id="notification-title" class="text-sm font-medium text-gray-900"></h3>
      <div id="notification-message" class="mt-1 text-sm text-gray-500"></div>
    </div>
    <button type="button" onclick="hideNotification()" class="flex-shrink-0 ml-4 text-gray-400 hover:text-gray-500">
      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
      </svg>
    </button>
  </div>
</div>

<script>
  // Notification functions
  function showNotification(type, title, message) {
    const notification = document.getElementById('notification');
    const notificationTitle = document.getElementById('notification-title');
    const notificationMessage = document.getElementById('notification-message');
    const notificationIcon = document.getElementById('notification-icon');
    
    // Set content
    notificationTitle.textContent = title;
    notificationMessage.textContent = message;
    
    // Set icon and colors based on type
    if (type === 'success') {
      notificationIcon.innerHTML = '<svg class="w-6 h-6 text-green-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>';
    } else if (type === 'error') {
      notificationIcon.innerHTML = '<svg class="w-6 h-6 text-red-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>';
    } else if (type === 'loading') {
      notificationIcon.innerHTML = '<svg class="w-6 h-6 text-blue-500 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
    }
    
    // Show notification
    notification.classList.remove('translate-y-[-100%]', 'opacity-0');
    notification.classList.add('translate-y-0', 'opacity-100');
    
    // Auto-hide after 5 seconds for success and error notifications
    if (type !== 'loading') {
      setTimeout(hideNotification, 5000);
    }
  }
  
  function hideNotification() {
    const notification = document.getElementById('notification');
    notification.classList.remove('translate-y-0', 'opacity-100');
    notification.classList.add('translate-y-[-100%]', 'opacity-0');
  }
  
  // Send appointment reminders function
  function sendAppointmentReminders() {
    const button = document.getElementById('send-reminders-btn');
    const originalText = button.innerHTML;
    
    // Show loading state
    button.disabled = true;
    button.innerHTML = '<svg class="w-5 h-5 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Sending...';
    
    // Show loading notification
    showNotification('loading', 'Sending Reminders', 'Processing appointment reminders...');
    
    // Make API call to send reminders
    fetch('/send_appointment_reminders', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({})
    })
    .then(response => response.json())
    .then(data => {
      // Reset button state
      button.disabled = false;
      button.innerHTML = originalText;
      
      // Show success notification
      if (data.success) {
        showNotification('success', 'Reminders Sent', data.message);
      } else {
        showNotification('error', 'Error', data.message || 'Failed to send reminders');
      }
    })
    .catch(error => {
      // Reset button state
      button.disabled = false;
      button.innerHTML = originalText;
      
      // Show error notification
      showNotification('error', 'Error', 'Failed to send reminders. Please try again.');
      console.error('Error sending reminders:', error);
    });
  }
  
  // Add event listener to the send reminders button
  document.addEventListener('DOMContentLoaded', function() {
    const sendRemindersBtn = document.getElementById('send-reminders-btn');
    if (sendRemindersBtn) {
      sendRemindersBtn.addEventListener('click', sendAppointmentReminders);
    }
  });
  
  fetch('../data.json')
  .then(response => response.json())
  .then(data => {
    const container = document.getElementById('data-container');
    document.getElementById('total-appointments').textContent = data.length;
    
    // Function to display all appointments
    function displayAppointments(filteredData) {
      container.innerHTML = '';
      
      filteredData.forEach(person => {
        const riskLevel = person.risk_level?.toLowerCase().trim();
        let riskColorClass = '';
        if (riskLevel === 'emergency') {
          riskColorClass = 'text-red-600'; 
        } else if (riskLevel === 'urgent') {
          riskColorClass = 'text-yellow-500'; 
        } else {
          riskColorClass = 'text-green-600';
        }

        const card = `
        <div class="bg-[var(--background-color)] rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 overflow-hidden flex flex-col">
          <div class="p-5 flex-grow">
            <h3 class="text-lg font-bold text-[var(--text-primary)] mb-2">${person.name}</h3>
            <div class="space-y-2 text-sm text-[var(--text-secondary)]">
              <p class="flex items-center ${riskColorClass}">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
                </svg>
                ${person.risk_level}
              </p>
              <p class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg>Appointment: ${person.appointment_date}</p>
              <p class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg>${person.address}</p>
              <p class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg>${person.contact}</p>
              <p class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg>${person.problem}</p>
            </div>
          </div>
          <div class="px-5 pb-5 mt-auto">
            <button onclick="window.location.href='/details?id=${person.id}'" class="w-full bg-[var(--primary-color)] text-white font-bold py-2 px-4 rounded-lg hover:bg-opacity-90 transition-colors">View</button>
          </div>
        </div>`;
        
        container.insertAdjacentHTML('beforeend', card);
      });
    }
    
    // Initial display of all appointments
    displayAppointments(data);
    
    // Date search functionality
    document.getElementById('search-by-date').addEventListener('click', function() {
      const searchDate = document.getElementById('date-search').value.trim();
      
      if (searchDate) {
        // Filter appointments by date
        const filteredData = data.filter(person => {
          return person.appointment_date.includes(searchDate);
        });
        
        // Update total appointments counter to show filtered count
        document.getElementById('total-appointments').textContent = filteredData.length;
        
        // Display a message if no appointments found for the date
        if (filteredData.length === 0) {
          container.innerHTML = `
            <div class="col-span-full text-center py-10">
              <svg class="w-16 h-16 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
              </svg>
              <h3 class="mt-4 text-lg font-medium text-[var(--text-primary)]">No appointments found for ${searchDate}</h3>
              <p class="mt-2 text-sm text-[var(--text-secondary)]">Try another date or clear the search to see all appointments.</p>
            </div>
          `;
        } else {
          displayAppointments(filteredData);
        }
      } else {
        // If search is empty, show all appointments
        document.getElementById('total-appointments').textContent = data.length;
        displayAppointments(data);
      }
    });
    
    // Also enable search when pressing Enter in the search field
    document.getElementById('date-search').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        document.getElementById('search-by-date').click();
      }
    });
    
    // Clear search functionality
    document.getElementById('clear-search').addEventListener('click', function() {
      document.getElementById('date-search').value = '';
      document.getElementById('date-filter-indicator').classList.add('hidden');
      document.getElementById('date-filter-indicator').textContent = '';
      document.getElementById('total-appointments').textContent = data.length;
      displayAppointments(data);
    });
    
    // Update filter indicator when searching
    document.getElementById('search-by-date').addEventListener('click', function() {
      const searchDate = document.getElementById('date-search').value.trim();
      const dateIndicator = document.getElementById('date-filter-indicator');
      
      if (searchDate) {
        dateIndicator.textContent = `Date: ${searchDate}`;
        dateIndicator.classList.remove('hidden');
      } else {
        dateIndicator.classList.add('hidden');
        dateIndicator.textContent = '';
      }
    });
  })
  .catch(error => console.error('Error loading JSON:', error));
</script>
</script>

</body></html>